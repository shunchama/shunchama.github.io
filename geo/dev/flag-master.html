<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸–ç•Œå›½æ——ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ Pro + Map</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background: #f0f2f5; margin: 0; padding: 15px; }
        #game-container { background: white; max-width: 500px; margin: 0 auto; padding: 20px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        
        /* åœ°åŸŸãƒœã‚¿ãƒ³ */
        .region-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .region-btn { padding: 10px 5px; font-size: 12px; cursor: pointer; border: 2px solid #eee; border-radius: 10px; background: white; transition: 0.3s; font-weight: bold; }
        .region-btn.active { background: #3498db; color: white; border-color: #3498db; }

        #progress { font-size: 16px; color: #555; margin-bottom: 15px; background: #f8f9fa; padding: 5px; border-radius: 20px; }
        
        .flag-box { height: 200px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; background: #fff; border: 1px solid #f0f0f0; border-radius: 10px; }
        #flag-img { max-height: 85%; max-width: 85%; border: 1px solid #eee; }
        
        /* ç­”ãˆã‚¨ãƒªã‚¢ */
        #answer-area { min-height: 120px; margin-bottom: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #name-jp { font-size: 26px; font-weight: bold; color: #2c3e50; margin: 0; }
        #name-en { font-size: 16px; color: #95a5a6; margin: 5px 0 10px 0; }
        
        /* åœ°å›³ãƒœã‚¿ãƒ³ */
        #map-link { display: none; text-decoration: none; background: #e67e22; color: white; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; transition: 0.2s; }
        #map-link:hover { background: #d35400; }

        /* ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        #action-btn { width: 100%; padding: 18px; font-size: 20px; cursor: pointer; background: #2ecc71; color: white; border: none; border-radius: 12px; box-shadow: 0 4px 0 #27ae60; }
        #action-btn:active { transform: translateY(2px); box-shadow: none; }
        
        #loading { margin-top: 100px; font-weight: bold; color: #3498db; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="region-grid">
        <button class="region-btn active" onclick="changeRegion('All', this)">ğŸŒ å…¨éƒ¨</button>
        <button class="region-btn" onclick="changeRegion('Asia', this)">ğŸ¥¢ ã‚¢ã‚¸ã‚¢</button>
        <button class="region-btn" onclick="changeRegion('Africa', this)">ğŸ˜ ã‚¢ãƒ•ãƒªã‚«</button>
        <button class="region-btn" onclick="changeRegion('Europe', this)">ğŸ° æ¬§å·</button>
        <button class="region-btn" onclick="changeRegion('North America', this)">ğŸ—½ åŒ—ç±³</button>
        <button class="region-btn" onclick="changeRegion('South America', this)">ğŸ· å—ç±³</button>
        <button class="region-btn" onclick="changeRegion('Oceania', this)">ğŸ„ ã‚ªã‚»ã‚¢ãƒ‹ã‚¢</button>
    </div>

    <div id="loading">åœ°çƒã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <div id="game-content" style="display:none;">
        <div id="progress">0 / 0</div>
        <div class="flag-box">
            <img id="flag-img" src="" alt="å›½æ——">
        </div>
        <div id="answer-area">
            <p id="name-jp"></p>
            <p id="name-en"></p>
            <a id="map-link" href="#" target="_blank">ğŸ“ Google Mapsã§å ´æ‰€ã‚’è¦‹ã‚‹</a>
        </div>
        <button id="action-btn">ç­”ãˆã‚’è¦‹ã‚‹</button>
    </div>
</div>

<script>
    let allCountries = [];
    let currentList = [];
    let currentIndex = 0;
    let showingAnswer = false;

    async function loadData() {
        try {
            // mapsã‚‚å–å¾—é …ç›®ã«è¿½åŠ 
            const res = await fetch('https://restcountries.com/v3.1/all?fields=name,translations,flags,region,subregion,maps');
            const data = await res.json();
            
            allCountries = data.map(c => {
                let r = c.region;
                if (c.subregion === 'South America') r = 'South America';
                if (c.subregion === 'North America' || c.subregion === 'Central America' || c.subregion === 'Caribbean') r = 'North America';
                
                return {
                    nameJp: c.translations.jpn ? c.translations.jpn.common : c.name.common,
                    nameEn: c.name.common,
                    flag: c.flags.png,
                    region: r,
                    mapUrl: c.maps.googleMaps // Google Mapsã®URLã‚’ä¿å­˜
                };
            });

            document.getElementById('loading').style.display = 'none';
            document.getElementById('game-content').style.display = 'block';
            changeRegion('All', document.querySelector('.region-btn'));
        } catch (e) {
            document.getElementById('loading').textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    function changeRegion(region, btnElement) {
        document.querySelectorAll('.region-btn').forEach(b => b.classList.remove('active'));
        btnElement.classList.add('active');

        currentList = (region === 'All') ? [...allCountries] : allCountries.filter(c => c.region === region);
        currentList.sort(() => Math.random() - 0.5);
        currentIndex = 0;
        showQuestion();
    }

    function showQuestion() {
        showingAnswer = false;
        const target = currentList[currentIndex];
        document.getElementById('flag-img').src = target.flag;
        document.getElementById('name-jp').textContent = "";
        document.getElementById('name-en').textContent = "";
        document.getElementById('map-link').style.display = "none"; // éè¡¨ç¤ºã«æˆ»ã™
        document.getElementById('action-btn').textContent = "ç­”ãˆã‚’è¦‹ã‚‹";
        document.getElementById('progress').textContent = `æ®‹ã‚Š: ${currentList.length - currentIndex} / å…¨: ${currentList.length}`;
    }

    document.getElementById('action-btn').onclick = () => {
        if (!showingAnswer) {
            const target = currentList[currentIndex];
            document.getElementById('name-jp').textContent = target.nameJp;
            document.getElementById('name-en').textContent = target.nameEn;
            
            // åœ°å›³ãƒœã‚¿ãƒ³ã®è¨­å®šã¨è¡¨ç¤º
            const mapLink = document.getElementById('map-link');
            mapLink.href = target.mapUrl;
            mapLink.style.display = "inline-block";
            
            document.getElementById('action-btn').textContent = (currentIndex + 1 >= currentList.length) ? "ã“ã®åœ°åŸŸã‚’æœ€åˆã‹ã‚‰" : "æ¬¡ã¸";
            showingAnswer = true;
        } else {
            if (currentIndex + 1 >= currentList.length) {
                currentList.sort(() => Math.random() - 0.5);
                currentIndex = 0;
            } else {
                currentIndex++;
            }
            showQuestion();
        }
    };

    loadData();
</script>
</body>
</html>