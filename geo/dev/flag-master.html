<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›½æ——ãƒã‚¹ã‚¿ãƒ¼ Pro</title>
    <style>
        :root { --primary: #3498db; --secondary: #2ecc71; --accent: #e67e22; --bg: #f0f2f5; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background: var(--bg); margin: 0; padding: 0; }
        
        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        nav { background: #fff; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: center; gap: 20px; position: sticky; top: 0; z-index: 100; }
        .nav-btn { padding: 10px 20px; cursor: pointer; border: none; background: none; font-size: 16px; font-weight: bold; color: #7f8c8d; border-bottom: 3px solid transparent; }
        .nav-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); }

        .container { max-width: 800px; margin: 20px auto; padding: 15px; }
        .page { display: none; }
        .page.active { display: block; }

        /* ã‚¯ã‚¤ã‚ºç”»é¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        #game-card { background: white; max-width: 450px; margin: 0 auto; padding: 25px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        .region-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .region-btn { padding: 8px; font-size: 12px; cursor: pointer; border: 1px solid #ddd; border-radius: 8px; background: white; }
        .region-btn.active { background: var(--primary); color: white; }
        .flag-box { height: 180px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; border: 1px solid #f0f0f0; }
        #flag-img { max-height: 90%; max-width: 90%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        #answer-area { min-height: 110px; }
        #action-btn { width: 100%; padding: 15px; font-size: 18px; cursor: pointer; background: var(--secondary); color: white; border: none; border-radius: 10px; box-shadow: 0 4px 0 #27ae60; }

        /* ä¸€è¦§ç”»é¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .list-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .flag-item { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s; }
        .flag-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .flag-item img { width: 100%; height: 80px; object-fit: contain; border: 1px solid #eee; margin-bottom: 8px; }
        .flag-item .name { font-size: 13px; font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .flag-item .link { font-size: 11px; color: var(--accent); text-decoration: none; display: block; margin-top: 5px; }

        #loading { margin-top: 100px; font-size: 20px; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<nav>
    <button class="nav-btn active" onclick="showPage('quiz-page', this)">ğŸ® ã‚¯ã‚¤ã‚º</button>
    <button class="nav-btn" onclick="showPage('list-page', this)">ğŸ“œ å›½æ——ä¸€è¦§</button>
</nav>

<div class="container">
    <div id="loading">åœ°çƒã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <div id="quiz-page" class="page">
        <div id="game-card">
            <div class="region-grid" id="quiz-regions">
                </div>
            <div id="progress" style="margin-bottom:10px; font-weight:bold;">0 / 0</div>
            <div class="flag-box"><img id="flag-img" src="" alt="å›½æ——"></div>
            <div id="answer-area">
                <p id="name-jp" style="font-size:24px; font-weight:bold; margin:0;"></p>
                <p id="name-en" style="color:#95a5a6; margin:5px 0;"></p>
                <a id="map-link" href="#" target="_blank" style="display:none; color:var(--accent); text-decoration:none; font-size:14px; font-weight:bold;">ğŸ“ å ´æ‰€ã‚’ç¢ºèª</a>
            </div>
            <button id="action-btn">ç­”ãˆã‚’è¦‹ã‚‹</button>
        </div>
    </div>

    <div id="list-page" class="page">
        <div class="region-grid" id="list-regions" style="max-width:500px; margin:0 auto 20px;">
            </div>
        <div class="list-grid" id="flag-list-container">
            </div>
    </div>
</div>

<script>
    let allCountries = [];
    let quizList = [];
    let currentQuizIndex = 0;
    let isShowingAnswer = false;
    const regions = [
        {id: 'All', name: 'å…¨éƒ¨'}, {id: 'Asia', name: 'ã‚¢ã‚¸ã‚¢'}, {id: 'Africa', name: 'ã‚¢ãƒ•ãƒªã‚«'},
        {id: 'Europe', name: 'æ¬§å·'}, {id: 'North America', name: 'åŒ—ç±³'}, 
        {id: 'South America', name: 'å—ç±³'}, {id: 'Oceania', name: 'ã‚ªã‚»ã‚¢ãƒ‹ã‚¢'}
    ];

    async function loadData() {
        try {
            const res = await fetch('https://restcountries.com/v3.1/all?fields=name,translations,flags,region,subregion,maps');
            const data = await res.json();
            allCountries = data.map(c => {
                let r = c.region;
                if (c.subregion === 'South America') r = 'South America';
                if (c.subregion === 'North America' || c.subregion === 'Central America' || c.subregion === 'Caribbean') r = 'North America';
                return {
                    nameJp: c.translations.jpn ? c.translations.jpn.common : c.name.common,
                    nameEn: c.name.common,
                    flag: c.flags.png,
                    region: r,
                    mapUrl: c.maps.googleMaps
                };
            }).sort((a, b) => a.nameJp.localeCompare(b.nameJp, 'ja'));

            initUI();
            document.getElementById('loading').style.display = 'none';
            showPage('quiz-page', document.querySelector('.nav-btn'));
        } catch (e) {
            document.getElementById('loading').textContent = "ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        }
    }

    function initUI() {
        const quizRegContainer = document.getElementById('quiz-regions');
        const listRegContainer = document.getElementById('list-regions');
        
        regions.forEach(reg => {
            // ã‚¯ã‚¤ã‚ºç”¨ãƒœã‚¿ãƒ³
            const b1 = document.createElement('button');
            b1.className = 'region-btn' + (reg.id==='All'?' active':'');
            b1.textContent = reg.name;
            b1.onclick = () => {
                document.querySelectorAll('#quiz-regions .region-btn').forEach(b=>b.classList.remove('active'));
                b1.classList.add('active');
                startQuiz(reg.id);
            };
            quizRegContainer.appendChild(b1);

            // ä¸€è¦§ç”¨ãƒœã‚¿ãƒ³
            const b2 = document.createElement('button');
            b2.className = 'region-btn' + (reg.id==='All'?' active':'');
            b2.textContent = reg.name;
            b2.onclick = () => {
                document.querySelectorAll('#list-regions .region-btn').forEach(b=>b.classList.remove('active'));
                b2.classList.add('active');
                renderList(reg.id);
            };
            listRegContainer.appendChild(b2);
        });
        startQuiz('All');
        renderList('All');
    }

    // ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ
    function showPage(pageId, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    // ã‚¯ã‚¤ã‚ºãƒ­ã‚¸ãƒƒã‚¯
    function startQuiz(region) {
        quizList = (region === 'All') ? [...allCountries] : allCountries.filter(c => c.region === region);
        quizList.sort(() => Math.random() - 0.5);
        currentQuizIndex = 0;
        showQuestion();
    }

    function showQuestion() {
        isShowingAnswer = false;
        const c = quizList[currentQuizIndex];
        document.getElementById('flag-img').src = c.flag;
        document.getElementById('name-jp').textContent = "";
        document.getElementById('name-en').textContent = "";
        document.getElementById('map-link').style.display = "none";
        document.getElementById('action-btn').textContent = "ç­”ãˆã‚’è¦‹ã‚‹";
        document.getElementById('progress').textContent = `${currentQuizIndex + 1} / ${quizList.length}`;
    }

    document.getElementById('action-btn').onclick = () => {
        if (!isShowingAnswer) {
            const c = quizList[currentQuizIndex];
            document.getElementById('name-jp').textContent = c.nameJp;
            document.getElementById('name-en').textContent = c.nameEn;
            document.getElementById('map-link').href = c.mapUrl;
            document.getElementById('map-link').style.display = "inline-block";
            document.getElementById('action-btn').textContent = "æ¬¡ã¸";
            isShowingAnswer = true;
        } else {
            currentQuizIndex = (currentQuizIndex + 1) % quizList.length;
            showQuestion();
        }
    };

    // ä¸€è¦§æç”»
    function renderList(region) {
        const container = document.getElementById('flag-list-container');
        container.innerHTML = "";
        const list = (region === 'All') ? allCountries : allCountries.filter(c => c.region === region);
        
        list.forEach(c => {
            const div = document.createElement('div');
            div.className = 'flag-item';
            div.innerHTML = `
                <img src="${c.flag}" alt="${c.nameJp}" loading="lazy">
                <div class="name">${c.nameJp}</div>
                <a class="link" href="${c.mapUrl}" target="_blank">ğŸ“ Maps</a>
            `;
            container.appendChild(div);
        });
    }

    loadData();
</script>
</body>
</html>